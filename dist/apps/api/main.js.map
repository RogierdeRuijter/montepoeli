{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./apps/api/src/jwt.strategy.ts","webpack:///./apps/api/src/main.ts","webpack:///./apps/api/src/models/create-dtos/create-game.dto.ts","webpack:///./apps/api/src/models/create-dtos/create-rule.dto.ts","webpack:///./apps/api/src/models/create-dtos/create-user.dto.ts","webpack:///./apps/api/src/modules/app/app.controller.ts","webpack:///./apps/api/src/modules/app/app.module.ts","webpack:///./apps/api/src/modules/auth/auth.module.ts","webpack:///./apps/api/src/modules/auth/auth.service.ts","webpack:///./apps/api/src/modules/game/game-mapper/game-mapper.service.ts","webpack:///./apps/api/src/modules/game/game-repository/game-repository.service.ts","webpack:///./apps/api/src/modules/game/game.controller.ts","webpack:///./apps/api/src/modules/game/game.module.ts","webpack:///./apps/api/src/modules/game/game.service/game.service.ts","webpack:///./apps/api/src/modules/rule/rule-mapper/rule-mapper.service.ts","webpack:///./apps/api/src/modules/rule/rule-repository/rule-repository.service.ts","webpack:///./apps/api/src/modules/rule/rule-service/rule.service.ts","webpack:///./apps/api/src/modules/rule/rule.controller.ts","webpack:///./apps/api/src/modules/rule/rule.module.ts","webpack:///./apps/api/src/modules/shared/services/sort/sort.service.ts","webpack:///./apps/api/src/modules/shared/services/util/util.service.ts","webpack:///./apps/api/src/modules/shared/shared.module.ts","webpack:///./apps/api/src/modules/users/user-repository/user-repository.service.ts","webpack:///./apps/api/src/modules/users/user.mapper.ts","webpack:///./apps/api/src/modules/users/users.controller.ts","webpack:///./apps/api/src/modules/users/users.module.ts","webpack:///./apps/api/src/modules/users/users.service.ts","webpack:///./apps/api/src/schemas/game.schema.ts","webpack:///./apps/api/src/schemas/rule.schema.ts","webpack:///./apps/api/src/schemas/user.schema.ts","webpack:///external \"@nestjs/common\"","webpack:///external \"@nestjs/core\"","webpack:///external \"@nestjs/jwt\"","webpack:///external \"@nestjs/mongoose\"","webpack:///external \"@nestjs/passport\"","webpack:///external \"bcrypt\"","webpack:///external \"compression\"","webpack:///external \"cookie-parser\"","webpack:///external \"express\"","webpack:///external \"fs\"","webpack:///external \"mongoose\"","webpack:///external \"passport-jwt\"","webpack:///external \"tslib\""],"names":[],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","import {ExtractJwt, Strategy} from 'passport-jwt';\nimport {AuthService} from './modules/auth/auth.service';\nimport {PassportStrategy} from '@nestjs/passport';\nimport {Injectable, UnauthorizedException} from '@nestjs/common';\nimport {JwtPayload} from './models/interfaces/jwt-payload.interface';\n\n@Injectable()\nexport class JwtStrategy extends PassportStrategy(Strategy) {\n\n  constructor(private readonly authService: AuthService) {\n    super({\n      jwtFromRequest: ExtractJwt.fromExtractors([(req) => {\n        let token = null;\n\n        if (req && req.signedCookies) {\n          token = req.signedCookies.montepoeliJwt;\n        }\n\n        return token;\n      }]),\n      secretOrKey: process.env.SERVER_SECRET,\n    });\n  }\n\n  async validate(payload: JwtPayload) {\n    const user = await this.authService.validateUser(payload);\n    if (!user) {\n      throw new UnauthorizedException();\n    }\n    return user;\n  }\n}\n","import {NestFactory} from '@nestjs/core';\nimport {AppModule} from './modules/app/app.module';\nimport * as cookieParser from 'cookie-parser';\nimport * as compression from 'compression';\nimport * as fs from 'fs';\n\nasync function bootstrap() {\n  let key: any;\n  let cert: any;\n\n  try {\n    key = fs.readFileSync('./secrets/localhost.key');\n    cert = fs.readFileSync('./secrets/localhost.crt');\n  } catch {\n    // tslint:disable-next-line\n    console.info('Cant read key or certificate');\n    // tslint:disable-next-line\n    console.info('This does not have to be an issue if you handle https another way or http is good enough for now');\n  }\n\n  const httpsOptions = {\n    key,\n    cert,\n  };\n\n  let app;\n  if (httpsOptions.key && httpsOptions.cert) {\n    app = await NestFactory.create(AppModule, { httpsOptions });\n  } else {\n    app = await NestFactory.create(AppModule);\n  }\n\n  checkEnvironmentVariables();\n\n  app.use(cookieParser(process.env.COOKIE_SECRET));\n  app.use(compression({threshold: 500}));\n  app.setGlobalPrefix('api');\n\n  let origin: boolean | string = true;\n  if (process.env.ENV === 'prod') {\n    origin = process.env.CORS_ORIGIN;\n  }\n\n  app.enableCors({\n    credentials: true, // TODO: check if the crendtials true is needed in production\n    origin,\n  });\n\n  await app.listen(3000);\n}\n\nconst checkEnvironmentVariables = () => {\n  const env = process.env.ENV.toString();\n  const cookieSecret = process.env.COOKIE_SECRET.toString();\n\n  if (isNullOrUndefined(env)) {\n    throwEnvironmentVariableShouldBeDefinedException('ENV');\n  }\n\n  // TODO: make this logic better understandable\n  if (!(env === 'prod' || env === 'dev')) {\n    throw new Error('ENV environment variable should be either: prod or dev');\n  }\n\n  if (isNullOrUndefined(cookieSecret)) {\n    throwEnvironmentVariableShouldBeDefinedException('COOKIE_SECRET');\n  }\n};\n\nconst isNullOrUndefined = (value: any) => {\n  return value === null || value === undefined;\n};\n\nconst throwEnvironmentVariableShouldBeDefinedException = (name: string) => {\n  throw new Error('environment variable: ' + name + ' should be defined');\n};\n\nbootstrap();\n","export class CreateGameDto {\n  black: string;\n  white: string;\n  winner: string;\n}\n","export class CreateRuleDto {\n  description: string;\n}\n","export class CreateUserDto {\n  username: string;\n  password: string;\n  preferedLanguage: string;\n}\n","import {BadRequestException, Body, Controller, Next, Post, Res} from '@nestjs/common';\nimport {UsersService} from '../users/users.service';\nimport {User} from '../../models/interfaces/user.interface';\nimport {AuthService} from '../auth/auth.service';\nimport {Response} from 'express';\nimport {CreateUserDto} from '../../models/create-dtos/create-user.dto';\n\n@Controller()\nexport class AppController {\n  constructor(private readonly usersService: UsersService,\n              private readonly authService: AuthService) {\n  }\n\n  private secure: boolean = process.env.ENV.toString() === 'prod' ? true : false;\n\n  // private sameSite: string = process.env.ENV.toString() === 'prod' ? 'Strict' : undefined;\n  // private signed: boolean = process.env.ENV.toString() === 'prod' ? true : undefined;\n\n  private domain: string = process.env.ENV.toString() === 'prod' ? process.env.DOMAIN : undefined;\n\n  @Post('/signIn')\n  public async signIn(@Body() body, @Res() res: Response, @Next() next): Promise<any> {\n    return await this.authService.signIn(body).then(reponse => {\n      const date = new Date();\n\n      res.cookie(\n        'montepoeliJwt',\n        reponse.jwt,\n        {\n          expires: new Date(date.setFullYear(date.getFullYear() + 1)),\n          httpOnly: true,\n          signed: true,\n          domain: this.domain,\n          secure: this.secure,\n          sameSite: 'strict'\n        }\n      );\n\n      res.cookie(\n        'montepoeliAuthenticated',\n        true,\n        {\n          expires: new Date(date.setFullYear(date.getFullYear() + 1)),\n          signed: true,\n          domain: this.domain,\n          secure: false,\n          sameSite: 'strict'\n        }\n      );\n\n      res.send();\n    });\n  }\n\n  @Post('/logout')\n  public async logout(@Res() res: Response): Promise<any> {\n    res.clearCookie('montepoeliJwt', {domain: this.domain});\n    res.clearCookie('montepoeliAuthenticated', {domain: this.domain});\n\n    res.send();\n  }\n\n  // TODO: find a remove way to create users\n  // @Post('/createUser')\n  // @UseGuards(AuthGuard())\n  public createUser(@Body() createUserDto: CreateUserDto): Promise<User> {\n    const username = createUserDto.username;\n    const password = createUserDto.password;\n\n    if (!username && !password) {\n      throw new BadRequestException('username and password should be defined');\n    }\n\n    return this.usersService.create(createUserDto);\n  }\n}\n","import {Module} from '@nestjs/common';\nimport {AppController} from './app.controller';\nimport {MongooseModule} from '@nestjs/mongoose';\nimport {AuthModule} from '../auth/auth.module';\nimport {UsersModule} from '../users/users.module';\nimport {GameModule} from '../game/game.module';\nimport {RuleModule} from '../rule/rule.module';\n\nconst username = process.env.MONGO_USERNAME;\nconst password = process.env.MONGO_PASSWORD;\n\nconst mongoDNS = process.env.MONGO_DNS_NAME;\n\nconst constructDatabaseUrl = () => {\n  let url = 'mongodb://';\n  if (username && password) {\n    url += username + ':' + password + '@';\n  }\n  url += mongoDNS + '/admin';\n  return url;\n};\n\n@Module({\n  imports: [\n    MongooseModule.forRoot(constructDatabaseUrl()),\n    AuthModule,\n    UsersModule,\n    GameModule,\n    RuleModule\n  ],\n  controllers: [AppController]\n})\nexport class AppModule {\n}\n","import {Module} from '@nestjs/common';\nimport {JwtModule} from '@nestjs/jwt';\nimport {AuthService} from './auth.service';\nimport {JwtStrategy} from '../../jwt.strategy';\nimport {PassportModule} from '@nestjs/passport';\nimport {UsersService} from '../users/users.service';\nimport {MongooseModule} from '@nestjs/mongoose';\nimport {UserSchema} from '../../schemas/user.schema';\nimport {UserMapper} from '../users/user.mapper';\nimport {UserRepositoryService} from '../users/user-repository/user-repository.service';\nimport {SharedModule} from '../shared/shared.module';\n\n@Module({\n  imports: [\n    PassportModule.register({\n      defaultStrategy: 'jwt',\n      session: false\n    }),\n    MongooseModule.forFeature([{name: 'User', schema: UserSchema}]),\n    JwtModule.register({\n      secret: process.env.SERVER_SECRET,\n      signOptions: {\n        expiresIn: '365 days',\n      },\n    }),\n    SharedModule,\n  ],\n  providers: [AuthService,\n    JwtStrategy,\n    UsersService,\n    UserMapper,\n    UserRepositoryService],\n  exports: [PassportModule, AuthService, JwtModule],\n})\nexport class AuthModule {}\n","import {JwtService} from '@nestjs/jwt';\nimport {Injectable, UnauthorizedException} from '@nestjs/common';\nimport {UsersService} from '../users/users.service';\nimport {JwtPayload} from '../../models/interfaces/jwt-payload.interface';\nimport {User} from '../../models/interfaces/user.interface';\nimport { UserMapper } from '../users/user.mapper';\n\n@Injectable()\nexport class AuthService {\n\n  constructor(\n    private readonly usersService: UsersService,\n    private readonly jwtService: JwtService,\n    private readonly userMapper: UserMapper\n  ) {\n  }\n\n  async signIn(body: any): Promise<any> {\n    return new Promise<any>((resolve, reject) => this.usersService.verifyUser(body)\n      .then((user: User) => {\n        const jwtPayload: JwtPayload = {username: user.username};\n        resolve(\n          { jwt: this.jwtService.sign(jwtPayload) }\n        );\n      }).catch((err) => {\n        reject(new UnauthorizedException('Wrong username or password.'));\n      }),\n    );\n  }\n\n  public async validateUser(payload: JwtPayload): Promise<any> {\n    return await this.usersService.findByUsername(payload);\n  }\n}\n","import {Injectable, NotFoundException} from '@nestjs/common';\nimport {UtilService} from '../../shared/services/util/util.service';\nimport {User} from '../../../models/interfaces/user.interface';\nimport {GameDto} from '../../../models/dtos/game.dto';\nimport {Game} from '../../../models/interfaces/game.interface';\nimport {CreateGameDto} from '../../../models/create-dtos/create-game.dto';\nimport {UserRepositoryService} from '../../users/user-repository/user-repository.service';\n\n@Injectable()\nexport class GameMapperService {\n\n  public constructor(private readonly userRepositoryService: UserRepositoryService,\n                     private readonly utilService: UtilService) {\n  }\n\n  public convertGames(games: Game[]): Promise<GameDto[]> {\n    return new Promise((resolve) =>\n      this.userRepositoryService.find().then((users: User[]) => {\n        resolve(this.swapUsersIdsWithNames(games, users));\n      }),\n    );\n  }\n\n  public swapUsersIdsWithNames(games: Game[], users: User[]): GameDto[] {\n    return games.map((game: Game) => {\n        const userBlack = users.find((user: User) => user.id === game.black);\n        const userWhite = users.find((user: User) => user.id === game.white);\n\n        return {\n          id: game.id,\n          black: userBlack ? userBlack.name : null,\n          white: userWhite ? userWhite.name : null,\n          winner: this.getWinnerUser(userBlack, userWhite, game),\n        } as GameDto;\n      },\n    );\n  }\n\n  private getWinnerUser(userBlack: User, userWhite: User, game: Game): string {\n    if (game.winner === null) {\n      return null;\n    }\n\n    if (userWhite && userWhite.id === game.winner) {\n      return userWhite.name;\n    }\n\n    if (userBlack && userBlack.id === game.winner) {\n      return userBlack.name;\n    }\n  }\n\n  public convertCreateDto(createGameDto: CreateGameDto): Promise<Game> {\n    // TODO: write unit test\n    return new Promise((resolve) =>\n      this.userRepositoryService.find().then((users: User[]) => {\n        const blackUser: User = users.find((user: User) => user.name.toLowerCase() === createGameDto.black.toLowerCase());\n        const whiteUser: User = users.find((user: User) => user.name.toLowerCase() === createGameDto.white.toLowerCase());\n\n        if (this.utilService.isNullOrUndefined(blackUser) || this.utilService.isNullOrUndefined(whiteUser)) {\n          throw new NotFoundException('user not found');\n        }\n\n        const winner = createGameDto.winner.toLowerCase();\n\n        let winnerUser: User;\n        // TODO: create constant\n        if (winner === 'draw') {\n          winnerUser = null;\n        } else {\n          winnerUser = users.find((user: User) => user.name.toLowerCase() === winner);\n        }\n\n        // @ts-ignore\n        resolve({\n          black: blackUser.id,\n          winner: winnerUser ? winnerUser.id : null,\n          white: whiteUser.id,\n        });\n      }),\n    );\n  }\n}\n","import {Injectable} from '@nestjs/common';\nimport {Game} from '../../../models/interfaces/game.interface';\nimport {InjectModel} from '@nestjs/mongoose';\nimport {Model} from 'mongoose';\n\n@Injectable()\nexport class GameRepositoryService {\n  constructor(@InjectModel('Game') private readonly gameModel: Model<any>) {\n  }\n\n  public find(): Promise<Game[]> {\n    return this.gameModel.find().exec();\n  }\n\n  public save(game: Game): Promise<Game> {\n    return new this.gameModel(game).save();\n  }\n\n}\n","import {Body, Controller, Get, Post, UseGuards} from '@nestjs/common';\nimport {GameService} from './game.service/game.service';\nimport {Game} from '../../models/interfaces/game.interface';\nimport {CreateGameDto} from '../../models/create-dtos/create-game.dto';\nimport {AuthGuard} from '@nestjs/passport';\nimport {GameDto} from '../../models/dtos/game.dto';\n\n@Controller('/game')\nexport class GameController {\n  constructor(private readonly gameService: GameService) {\n  }\n\n  @Get()\n  @UseGuards(AuthGuard())\n  public getAll(): Promise<GameDto[]> {\n    return this.gameService.getGames();\n  }\n\n  @Post('/create')\n  @UseGuards(AuthGuard())\n  public async create(@Body() body: CreateGameDto): Promise<Game> {\n    return this.gameService.create(body);\n  }\n}\n","import {Module} from '@nestjs/common';\nimport {GameService} from './game.service/game.service';\nimport {GameController} from './game.controller';\nimport {MongooseModule} from '@nestjs/mongoose';\nimport {AuthModule} from '../auth/auth.module';\nimport {GameSchema} from '../../schemas/game.schema';\nimport {SharedModule} from '../shared/shared.module';\nimport {GameMapperService} from './game-mapper/game-mapper.service';\nimport {GameRepositoryService} from './game-repository/game-repository.service';\nimport {UsersModule} from '../users/users.module';\n\n@Module({\n  imports: [\n    MongooseModule.forFeature([{name: 'Game', schema: GameSchema}]),\n    AuthModule,\n    SharedModule,\n    UsersModule,\n  ],\n  providers: [GameService, GameMapperService, GameRepositoryService],\n  controllers: [GameController],\n  exports: [],\n})\nexport class GameModule {\n}\n","import {BadRequestException, Injectable} from '@nestjs/common';\nimport {Game} from '../../../models/interfaces/game.interface';\nimport {CreateGameDto} from '../../../models/create-dtos/create-game.dto';\nimport {GameDto} from '../../../models/dtos/game.dto';\nimport {SortService} from '../../shared/services/sort/sort.service';\nimport {GameMapperService} from '../game-mapper/game-mapper.service';\nimport {GameRepositoryService} from '../game-repository/game-repository.service';\n\n@Injectable()\nexport class GameService {\n  public constructor(private readonly gameMapper: GameMapperService,\n                     private readonly sortService: SortService,\n                     private readonly gameRepositoryService: GameRepositoryService) {\n  }\n\n  public async getGames(): Promise<GameDto[]> {\n    const unSortedGames: Game[] = await this.gameRepositoryService.find();\n    const games = this.sortService.sortByDateDescending(unSortedGames);\n\n    return this.gameMapper.convertGames(games);\n  }\n\n  public create(createGameDto: CreateGameDto): Promise<Game> {\n    if (this.validDto(createGameDto)) {\n      return this.gameMapper.convertCreateDto(createGameDto)\n        .then((game: Game) => this.gameRepositoryService.save(game));\n    }\n  }\n\n  private validDto(createGameDto: CreateGameDto): boolean {\n    if (!createGameDto.black || !createGameDto.white || !createGameDto.winner) {\n      throw new BadRequestException('not all fields defined');\n    }\n\n    return true;\n  }\n}\n","import {Injectable} from '@nestjs/common';\nimport {Mapper} from '../../../models/interfaces/mapper.interface';\nimport {RuleDto} from '../../../models/dtos/rule.dto';\nimport {Rule} from '../../../models/interfaces/rule.interface';\n\n@Injectable()\nexport class RuleMapperService implements Mapper<RuleDto> {\n  public convert(rule: Rule): RuleDto {\n    return {\n      description: rule.description\n    };\n  }\n\n}\n","import {Injectable} from '@nestjs/common';\nimport {InjectModel} from '@nestjs/mongoose';\nimport {Model} from 'mongoose';\nimport {Rule} from '../../../models/interfaces/rule.interface';\n\n@Injectable()\nexport class RuleRepositoryService {\n  constructor(@InjectModel('Rule') private readonly ruleModel: Model<any>) {\n  }\n\n  public find(): Promise<Rule[]> {\n    return this.ruleModel.find().exec();\n  }\n\n  public save(rule: Rule): Promise<Rule> {\n    return new this.ruleModel(rule).save();\n  }\n}\n","import {Injectable} from '@nestjs/common';\nimport {RuleDto} from '../../../models/dtos/rule.dto';\nimport {CreateRuleDto} from '../../../models/create-dtos/create-rule.dto';\nimport {RuleRepositoryService} from '../rule-repository/rule-repository.service';\nimport {Rule} from '../../../models/interfaces/rule.interface';\nimport {RuleMapperService} from '../rule-mapper/rule-mapper.service';\nimport {SortService} from '../../shared/services/sort/sort.service';\n\n@Injectable()\nexport class RuleService {\n  constructor(private ruleRepositoryService: RuleRepositoryService,\n              private ruleMapperService: RuleMapperService,\n              private sortService: SortService) {\n  }\n\n  public async getAll(): Promise<RuleDto[]> {\n    const unSortedRules: Rule[] = await this.ruleRepositoryService.find();\n    const rules = this.sortService.sortByDateDescending(unSortedRules);\n\n    return rules.map((rule: Rule) => this.ruleMapperService.convert(rule));\n  }\n\n  public async create(createRuleDto: CreateRuleDto): Promise<RuleDto> {\n    const newRule: Rule = {\n      description: createRuleDto.description,\n      date: new Date(Date.now())\n    };\n\n    const rule = await this.ruleRepositoryService.save(newRule);\n\n    return this.ruleMapperService.convert(rule);\n  }\n}\n","import {Body, Controller, Get, Post} from '@nestjs/common';\nimport {RuleService} from './rule-service/rule.service';\nimport {RuleDto} from '../../models/dtos/rule.dto';\nimport {CreateRuleDto} from '../../models/create-dtos/create-rule.dto';\n\n@Controller('/rule')\nexport class RuleController {\n  constructor(private ruleService: RuleService) {}\n\n  @Get()\n  // @UseGuards(AuthGuard())\n  public getAll(): Promise<RuleDto[]> {\n    return this.ruleService.getAll();\n  }\n\n  @Post('/create')\n  // @UseGuards(AuthGuard())\n  public async create(@Body() body: CreateRuleDto): Promise<RuleDto> {\n    return this.ruleService.create(body);\n  }\n}\n","import {Module} from '@nestjs/common';\nimport {RuleController} from './rule.controller';\nimport {MongooseModule} from '@nestjs/mongoose';\nimport {AuthModule} from '../auth/auth.module';\nimport {SharedModule} from '../shared/shared.module';\nimport {RuleService} from './rule-service/rule.service';\nimport {RuleSchema} from '../../schemas/rule.schema';\nimport {RuleRepositoryService} from './rule-repository/rule-repository.service';\nimport {RuleMapperService} from './rule-mapper/rule-mapper.service';\n\n@Module({\n  imports: [\n    MongooseModule.forFeature([{name: 'Rule', schema: RuleSchema}]),\n    AuthModule,\n    SharedModule\n  ],\n  providers: [RuleService, RuleRepositoryService, RuleMapperService],\n  controllers: [RuleController],\n  exports: [],\n})\nexport class RuleModule {\n}\n","import {Injectable} from '@nestjs/common';\n\n@Injectable()\nexport class SortService {\n  public sortByDateDescending(objects: any[]): any[] {\n    return objects.sort((n1, n2) => n2.date.getTime() - n1.date.getTime());\n  }\n\n  public sortByDateAscending(objects: any[]): any[] {\n    return objects.sort((n1, n2) => n1.date.getTime() - n2.date.getTime() );\n  }\n}\n","import {Injectable} from '@nestjs/common';\n\n@Injectable()\nexport class UtilService {\n  public isNullOrUndefined(value: any): boolean {\n    return value === null || value === undefined;\n  }\n}\n","import {Module} from '@nestjs/common';\nimport {SortService} from './services/sort/sort.service';\nimport {UtilService} from './services/util/util.service';\n\n@Module({\n  imports: [],\n  providers: [\n    SortService,\n    UtilService,\n  ],\n  controllers: [],\n  exports: [\n    SortService,\n    UtilService,\n  ],\n})\nexport class SharedModule {\n}\n","import {Injectable, InternalServerErrorException} from '@nestjs/common';\nimport {User} from '../../../models/interfaces/user.interface';\nimport {InjectModel} from '@nestjs/mongoose';\nimport {Model} from 'mongoose';\n\n@Injectable()\nexport class UserRepositoryService {\n\n  constructor(@InjectModel('User') private readonly userModel: Model<any>) {\n  }\n\n  public find(): Promise<User[]> {\n    return this.userModel.find().exec();\n  }\n\n  public async findByUsername(username: string): Promise<User> {\n    const users = await this.userModel.find({username}).exec();\n\n    if (users.length > 1) {\n      throw new InternalServerErrorException('more than 1 user with the same username');\n    }\n\n    return users[0];\n  }\n\n  public save(user: User): Promise<User> {\n    return new this.userModel(user).save();\n  }\n\n  public async updateLanguagePreferance(username: string, languagePreferance: string): Promise<User> {\n    return this.userModel.updateOne({username}, {\n      preferedLanguage: languagePreferance\n    });\n  }\n}\n","import {Injectable} from '@nestjs/common';\nimport {User} from '../../models/interfaces/user.interface';\nimport {Mapper} from '../../models/interfaces/mapper.interface';\nimport {UserDto} from '../../models/dtos/user.dto';\n\n@Injectable()\nexport class UserMapper implements Mapper<UserDto> {\n  public convertUsers(users: User[]): UserDto[] {\n    return users.map((user: User) => this.convert(user));\n  }\n\n  public convert(user: User): UserDto {\n    return {\n      name: user.name,\n      preferedLanguage: user.preferedLanguage\n    };\n  }\n}\n","import {BadRequestException, Body, Controller, Get, UseGuards, Post, Req} from '@nestjs/common';\nimport {UsersService} from './users.service';\nimport {User} from '../../models/interfaces/user.interface';\nimport {CreateUserDto} from '../../models/create-dtos/create-user.dto';\nimport {AuthGuard} from '@nestjs/passport';\nimport { Request } from 'express';\nimport { UserDto } from '../../models/dtos/user.dto';\n\n@Controller('/users')\n@UseGuards(AuthGuard())\nexport class UsersController {\n\n  private domain: string = process.env.ENV.toString() === 'prod' ? process.env.DOMAIN : undefined;\n\n  constructor(private readonly usersService: UsersService) {\n  }\n\n  @Get()\n  public async getUsers(): Promise<any> {\n    return this.usersService.getAllUsers();\n  }\n\n  // @Post('/create')\n  public createUser(@Body() createUserDto: CreateUserDto): Promise<User> {\n    const username = createUserDto.username;\n    const password = createUserDto.password;\n\n    if (!username && !password) {\n      throw new BadRequestException('username and password should be defined');\n    }\n\n    return this.usersService.create(createUserDto);\n  }\n\n  @Post('/language-preference')\n  public async setLanguagePreference(@Body() body: any): Promise<any> {\n    const username: string = body.username;\n    const languagePreference: string = body.languagePreference;\n\n    if (!username || !languagePreference) {\n      throw new BadRequestException('username or languagePreference is not defined');\n    }\n\n    if (languagePreference !== 'dutch' && languagePreference !== 'english') {\n      throw new BadRequestException('language preference should be dutch or english');\n    }\n\n    return this.usersService.setLanguagePreference(username, languagePreference);\n  }\n\n  @Get('/current')\n  public async getCurrentUser(@Req() req: Request): Promise<UserDto> {\n    const jwt = req?.signedCookies?.montepoeliJwt;\n\n    return this.usersService.getUserWithJwt(jwt);\n  }\n}\n","import {Module} from '@nestjs/common';\nimport {UsersService} from './users.service';\nimport {MongooseModule} from '@nestjs/mongoose';\nimport {UserSchema} from '../../schemas/user.schema';\nimport {UserMapper} from './user.mapper';\nimport {UsersController} from './users.controller';\nimport {AuthModule} from '../auth/auth.module';\nimport {UserRepositoryService} from './user-repository/user-repository.service';\nimport {SharedModule} from '../shared/shared.module';\n\n@Module({\n  imports: [\n    MongooseModule.forFeature([{name: 'User', schema: UserSchema}]),\n    AuthModule,\n    SharedModule\n  ],\n  controllers: [UsersController],\n  providers: [UsersService, UserMapper, UserRepositoryService],\n  exports: [UsersService, UserRepositoryService],\n})\nexport class UsersModule {}\n","import {Injectable} from '@nestjs/common';\nimport {User} from '../../models/interfaces/user.interface';\nimport {CreateUserDto} from '../../models/create-dtos/create-user.dto';\nimport {JwtPayload} from '../../models/interfaces/jwt-payload.interface';\nimport * as bcrypt from 'bcrypt';\nimport {UserDto} from '../../models/dtos/user.dto';\nimport {UserMapper} from './user.mapper';\nimport {UserRepositoryService} from './user-repository/user-repository.service';\nimport {UtilService} from '../shared/services/util/util.service';\nimport { JwtService } from '@nestjs/jwt';\n\n@Injectable()\nexport class UsersService {\n  constructor(private readonly userRepositoryService: UserRepositoryService,\n              private readonly userMapper: UserMapper,\n              private readonly utilService: UtilService,\n              private readonly jwtService: JwtService) {\n  }\n  public findByUsername(payload: JwtPayload): Promise<User> {\n    return this.userRepositoryService.findByUsername(payload.username);\n  }\n\n  public verifyUser(payload): Promise<User> {\n    return new Promise((resolve, reject) => this.userRepositoryService.findByUsername(payload.username).then((user: User) => {\n      if (this.utilService.isNullOrUndefined(user)) {\n        reject('user not found');\n        return;\n      }\n\n      bcrypt.compare(payload.password, user.password, (err, res) => {\n        if (res === true) {\n          resolve(user);\n        } else if (res === false) {\n          reject('hash comparison failed');\n        }\n      });\n    }));\n  }\n\n  public create(createUserDto: CreateUserDto): Promise<User> {\n    return new Promise((resolve) => bcrypt.hash(createUserDto.password, 10, (err, passwordHash) => {\n      createUserDto.password = passwordHash;\n      // @ts-ignore\n      // FIXME: convert dto\n      resolve(this.userRepositoryService.save(createUserDto));\n    }));\n  }\n\n  public getAllUsers(): Promise<UserDto[]> {\n    return new Promise<UserDto[]>(resolve => {\n      this.userRepositoryService.find().then((users: User[]) =>\n        resolve(this.userMapper.convertUsers(users)));\n    });\n  }\n\n  // TODO: write unit test\n  public setLanguagePreference(username: string, languagePreferance: string): Promise<User> {\n      return this.userRepositoryService.updateLanguagePreferance(username, languagePreferance);\n  }\n\n  public async getUserWithJwt(jwt: string): Promise<UserDto> {\n    // @ts-ignore\n    const username: string = this.jwtService.decode(jwt).username;\n\n    const user = await this.userRepositoryService.findByUsername(username);\n\n    return this.userMapper.convert(user);\n  }\n}\n","import * as mongoose from 'mongoose';\n\nexport const GameSchema = new mongoose.Schema({\n  black: String,\n  white: String,\n  winner: String,\n  date: {type: Date, default: Date.now}\n});\n","import * as mongoose from 'mongoose';\n\nexport const RuleSchema = new mongoose.Schema({\n  description: String,\n  date: Date\n});\n","import * as mongoose from 'mongoose';\n\nexport const UserSchema = new mongoose.Schema({\n  username: String,\n  password: String,\n  name: String,\n  preferedLanguage: String\n});\n","module.exports = require(\"@nestjs/common\");","module.exports = require(\"@nestjs/core\");","module.exports = require(\"@nestjs/jwt\");","module.exports = require(\"@nestjs/mongoose\");","module.exports = require(\"@nestjs/passport\");","module.exports = require(\"bcrypt\");","module.exports = require(\"compression\");","module.exports = require(\"cookie-parser\");","module.exports = require(\"express\");","module.exports = require(\"fs\");","module.exports = require(\"mongoose\");","module.exports = require(\"passport-jwt\");","module.exports = require(\"tslib\");"],"sourceRoot":""}